<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æˆ‘çš„æ¡£æ¡ˆ - é»‘çˆªä¼šè®®å®¤</title>
    <link rel="stylesheet" href="styles/main.css" />
    <link rel="stylesheet" href="styles/profile.css" />
</head>

<body>
    <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
    <button class="theme-toggle" id="themeToggle">ğŸŒ™</button>

    <!-- å†…å®¹åŒº -->
    <div class="profile-container" id="profileContainer">
        <div class="loading">æ­£åœ¨åŠ è½½ä½ çš„æ¡£æ¡ˆ...</div>
    </div>

    <!-- é€€å‡ºç™»å½•æŒ‰é’® -->
    <div class="logout-section">
        <button id="logoutBtn" class="logout-btn">é€€å‡ºç™»å½•</button>
    </div>
    <!-- åº•éƒ¨å¯¼èˆªæ  -->
    <div class="fixed-bottom-nav">
        <a href="/news.html" class="nav-tab">
            <div>é»‘çˆªåŠ¨æ€</div>
        </a>
        <a href="./main.html" class="nav-tab">
            <div>ä¸»é¡µ</div>
        </a>
        <a href="/profile.html" class="nav-tab active">
            <div>æˆ‘çš„</div>
        </a>
    </div>

    <script>
        // ========== å·¥å…·å‡½æ•° ==========
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) {
                try {
                    return JSON.parse(decodeURIComponent(parts.pop().split(';').shift()));
                } catch (e) {
                    return null;
                }
            }
            return null;
        }

        function deleteCookie(name) {
            document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/`;
        }

        // ========== èº«ä»½éªŒè¯ ==========
        async function verifyAuth() {
            const auth = getCookie('auth');
            if (!auth || !auth.battletag) {
                deleteCookie('auth');
                window.location.href = './';
                return null;
            }
            return auth.battletag;
        }

        // è‹±é›„æ•°æ®ï¼ˆç•¥ï¼Œä¿æŒåŸæ ·ï¼‰
        const heroesData = [
            { en: 'doomfist', zh: 'æœ«æ—¥é“æ‹³', role: 'tank', position: 'é‡è£…' },
            { en: 'sigma', zh: 'è¥¿æ ¼ç›', role: 'tank', position: 'é‡è£…' },
            { en: 'orisa', zh: 'å¥¥ä¸½è', role: 'tank', position: 'é‡è£…' },
            { en: 'ramattra', zh: 'æ‹‰ç›åˆ¹', role: 'tank', position: 'é‡è£…' },
            { en: 'reinhardt', zh: 'è±å› å“ˆç‰¹', role: 'tank', position: 'é‡è£…' },
            { en: 'roadhog', zh: 'è·¯éœ¸', role: 'tank', position: 'é‡è£…' },
            { en: 'winston', zh: 'æ¸©æ–¯é¡¿', role: 'tank', position: 'é‡è£…' },
            { en: 'wrecking-ball', zh: 'ç ´åçƒ', role: 'tank', position: 'é‡è£…' },
            { en: 'zarya', zh: 'æŸ¥è‰å¨…', role: 'tank', position: 'é‡è£…' },
            { en: 'dva', zh: 'D.Va', role: 'tank', position: 'é‡è£…' },
            { en: 'junker-queen', zh: 'æ¸£å®¢å¥³ç‹', role: 'tank', position: 'é‡è£…' },
            { en: 'mauga', zh: 'æ¯›åŠ ', role: 'tank', position: 'é‡è£…' },
            { en: 'hazard', zh: 'éª‡ç¾', role: 'tank', position: 'é‡è£…' },
            { en: 'freja', zh: 'å¼—è•¾é›…', role: 'tank', position: 'é‡è£…' },

            { en: 'cassidy', zh: 'å¡è¥¿è¿ª', role: 'damage', position: 'è¾“å‡º' },
            { en: 'genji', zh: 'æºæ°', role: 'damage', position: 'è¾“å‡º' },
            { en: 'pharah', zh: 'æ³•è€ä¹‹é¹°', role: 'damage', position: 'è¾“å‡º' },
            { en: 'reaper', zh: 'æ­»ç¥', role: 'damage', position: 'è¾“å‡º' },
            { en: 'soldier-76', zh: 'å£«å…µï¼š76', role: 'damage', position: 'è¾“å‡º' },
            { en: 'sombra', zh: 'é»‘å½±', role: 'damage', position: 'è¾“å‡º' },
            { en: 'tracer', zh: 'çŒç©º', role: 'damage', position: 'è¾“å‡º' },
            { en: 'bastion', zh: 'å ¡å’', role: 'damage', position: 'è¾“å‡º' },
            { en: 'hanzo', zh: 'åŠè—', role: 'damage', position: 'è¾“å‡º' },
            { en: 'junkrat', zh: 'ç‹‚é¼ ', role: 'damage', position: 'è¾“å‡º' },
            { en: 'mei', zh: 'ç¾', role: 'damage', position: 'è¾“å‡º' },
            { en: 'torbjorn', zh: 'æ‰˜æ¯”æ˜‚', role: 'damage', position: 'è¾“å‡º' },
            { en: 'widowmaker', zh: 'é»‘ç™¾åˆ', role: 'damage', position: 'è¾“å‡º' },
            { en: 'ashe', zh: 'è‰¾ä»€', role: 'damage', position: 'è¾“å‡º' },
            { en: 'echo', zh: 'å›å£°', role: 'damage', position: 'è¾“å‡º' },
            { en: 'sojourn', zh: 'ç´¢æ°æ©', role: 'damage', position: 'è¾“å‡º' },
            { en: 'symmetra', zh: 'ç§©åºä¹‹å…‰', role: 'damage', position: 'è¾“å‡º' },
            { en: 'juno', zh: 'æœ±è¯º', role: 'damage', position: 'è¾“å‡º' },
            { en: 'wuyang', zh: 'æ— æ¼¾', role: 'damage', position: 'è¾“å‡º' },
            { en: 'venture', zh: 'æ¢å¥‡', role: 'damage', position: 'è¾“å‡º' },

            { en: 'ana', zh: 'å®‰å¨œ', role: 'support', position: 'æ”¯æ´' },
            { en: 'baptiste', zh: 'å·´è’‚æ–¯ç‰¹', role: 'support', position: 'æ”¯æ´' },
            { en: 'brigitte', zh: 'å¸ƒä¸½å‰å¡”', role: 'support', position: 'æ”¯æ´' },
            { en: 'lucio', zh: 'å¢è¥¿å¥¥', role: 'support', position: 'æ”¯æ´' },
            { en: 'mercy', zh: 'å¤©ä½¿', role: 'support', position: 'æ”¯æ´' },
            { en: 'moira', zh: 'è«ä¼Šæ‹‰', role: 'support', position: 'æ”¯æ´' },
            { en: 'zenyatta', zh: 'ç¦…é›…å¡”', role: 'support', position: 'æ”¯æ´' },
            { en: 'kiriko', zh: 'é›¾å­', role: 'support', position: 'æ”¯æ´' },
            { en: 'lifeweaver', zh: 'ç”Ÿå‘½ä¹‹æ¢­', role: 'support', position: 'æ”¯æ´' },
            { en: 'illari', zh: 'ä¼Šæ‹‰é”', role: 'support', position: 'æ”¯æ´' }
        ];

        let currentHeroList = [];
        let originalHeroList = [];
        let isEditing = false;
        let battletag = '';
        let fullUserData = null; // ç”¨äºç¼“å­˜ä»æœåŠ¡å™¨åŠ è½½çš„å®Œæ•´ç”¨æˆ·æ¡£æ¡ˆ

        async function renderProfile(tag) {
            battletag = tag;
            const container = document.getElementById('profileContainer');
            const encodedTag = encodeURIComponent(tag);
            const avatarPath = `./imge/${encodedTag}.jpg`;

            const greetings = [
                'åˆ«æ¥æ— æ™~', 'å¥½ä¹…ä¸è§ï¼', 'æ¬¢è¿ä½ ï¼Œç‰¹å·¥', 'è¿‘æ¥å¯å¥½ï¼Ÿ', 'ä»Šå¤©å¤©æ°”ä¸é”™',
                'é»‘çˆªéœ€è¦ä½ ', 'åˆè§é¢äº†ï¼', 'ä»»åŠ¡é¡ºåˆ©å—ï¼Ÿ', 'ä¸€åˆ‡å®‰å¥½ï¼Ÿ'
            ];
            const greeting = greetings[Math.floor(Math.random() * greetings.length)];

            let userData = null;
            let isPendingSubmission = false;

            // Step 1: ä¼˜å…ˆå°è¯•ä» talon-public åŠ è½½ï¼ˆç”¨æˆ·æäº¤ä½†æœªå®¡æ ¸ï¼‰
            try {
                const publicRes = await fetch(
                    `https://talon-public-1258609989.cos.ap-chongqing.myqcloud.com/${encodedTag}/${encodedTag}.json?t=${Date.now()}`
                );
                if (publicRes.ok) {
                    userData = await publicRes.json();
                    isPendingSubmission = true;
                }
            } catch (err) {
                console.warn('Public config not found or failed to load:', err);
            }

            // Step 2: å¦‚æœ public æ²¡æœ‰ï¼Œåˆ™å›é€€åˆ° talon-adminï¼ˆå·²å®¡æ ¸ï¼‰
            if (!userData) {
                try {
                    const adminRes = await fetch(
                        `https://talon-admin-1258609989.cos.ap-chongqing.myqcloud.com/${encodedTag}/${encodedTag}.json?t=${Date.now()}`
                    );
                    if (!adminRes.ok) throw new Error('Admin data not found');
                    userData = await adminRes.json();
                } catch (err) {
                    console.error('Failed to load both public and admin profile:', err);
                    container.innerHTML = `<div class="error">âš ï¸ æ— æ³•åŠ è½½ä½ çš„æ¡£æ¡ˆ<br>è¯·ç¡®è®¤è´¦å·å·²æ³¨å†Œ</div>`;
                    return;
                }
            }

            // âœ… å…³é”®ï¼šç¼“å­˜å®Œæ•´ç”¨æˆ·æ•°æ®
            fullUserData = userData;

            // Step 3: å¤„ç†è‹±é›„åˆ—è¡¨
            currentHeroList = (userData.hero && Array.isArray(userData.hero)) ? userData.hero.slice(0, 5) : [];
            while (currentHeroList.length < 5) currentHeroList.push(null);
            originalHeroList = [...currentHeroList];

            // Step 4: æ¸²æŸ“ UI
            let statusNotice = '';
            if (isPendingSubmission) {
                statusNotice = '<div class="pending-notice">å­˜åœ¨å¾…ç®¡ç†å‘˜ Node éªŒè¯çš„æäº¤ï¼Œåœ¨å¿«é©¬åŠ é­å•¦~</div>';
            }

            container.innerHTML = `
        <img src="${avatarPath}" alt="${tag}" class="profile-avatar" onerror="this.style.opacity='0.5'" />
        <div class="profile-greeting">${greeting}</div>
        <div class="profile-id">${tag}</div>
        ${statusNotice}
        <div class="hero-edit-wrapper">
            <div class="profile-heroes" id="profileHeroes"></div>
            <button class="edit-btn" id="editBtn">âœ ç¼–è¾‘</button>
        </div>
        <div class="edit-actions" id="editActions" style="display:none;">
            <button class="btn-save">ğŸ’¾ ä¿å­˜</button>
            <button class="btn-cancel">âŒ å–æ¶ˆ</button>
        </div>
    `;

            renderHeroesUI();
            bindEditEvents();
        }

        function renderHeroesUI() {
            const heroContainer = document.getElementById('profileHeroes');
            if (!heroContainer) return;

            heroContainer.innerHTML = '';
            currentHeroList.forEach((heroKey, index) => {
                const item = document.createElement('div');
                item.className = 'hero-slot';
                item.dataset.index = index;

                if (heroKey) {
                    item.innerHTML = `
                <div class="profile-hero-icon">
                    <img src="https://ow.mapleqaq.top/hero/${encodeURIComponent(heroKey)}.png" alt="${heroKey}" loading="lazy" />
                    <button class="remove-hero" style="display:none;">âœ•</button>
                </div>
            `;
                } else {
                    item.innerHTML = `
                <div class="empty-slot" data-index="${index}">
                    <span>+</span>
                </div>
            `;
                }
                heroContainer.appendChild(item);
            });
        }

        function bindEditEvents() {
            const editBtn = document.getElementById('editBtn');
            const saveBtn = document.querySelector('.btn-save');
            const cancelBtn = document.querySelector('.btn-cancel');
            const heroContainer = document.getElementById('profileHeroes');

            editBtn.onclick = () => {
                isEditing = true;
                document.querySelectorAll('.remove-hero').forEach(btn => btn.style.display = 'block');
                document.getElementById('editActions').style.display = 'flex';
                editBtn.style.display = 'none';
            };

            cancelBtn.onclick = async () => {
                const encodedTag = encodeURIComponent(battletag);
                try {
                    const res = await fetch(
                        `https://talon-admin-1258609989.cos.ap-chongqing.myqcloud.com/${encodedTag}/${encodedTag}.json?t=${Date.now()}`
                    );
                    if (res.ok) {
                        const userData = await res.json();
                        currentHeroList = (userData.hero && Array.isArray(userData.hero)) ? userData.hero.slice(0, 5) : [];
                        while (currentHeroList.length < 5) currentHeroList.push(null);
                        originalHeroList = [...currentHeroList];
                    }
                } catch (e) {
                    console.warn('å–æ¶ˆæ—¶é‡è½½å¤±è´¥ï¼Œä½¿ç”¨ç¼“å­˜å‰¯æœ¬');
                    currentHeroList = [...originalHeroList];
                }
                renderHeroesUI();
                exitEditMode();
            };

            saveBtn.onclick = async () => {
                await handleSave();
            };

            heroContainer.onclick = (e) => {
                if (!isEditing) return;

                if (e.target.classList.contains('remove-hero')) {
                    const slot = e.target.closest('.hero-slot');
                    const index = parseInt(slot.dataset.index);
                    currentHeroList[index] = null;
                    renderHeroesUI();
                    return;
                }

                const emptySlot = e.target.closest('.empty-slot');
                if (emptySlot) {
                    const slot = emptySlot.closest('.hero-slot');
                    const index = parseInt(slot.dataset.index);
                    showHeroPickerByIndex(index);
                }
            };
        }

        async function handleSave() {
            const encodedTag = encodeURIComponent(battletag);
            const cleanHeroes = currentHeroList.filter(h => h !== null);

            // âœ… åŸºäºç¼“å­˜çš„å®Œæ•´ç”¨æˆ·æ•°æ®ï¼Œä»…æ›´æ–° hero å­—æ®µ
            if (!fullUserData) {
                alert('âŒ æœªåŠ è½½ç”¨æˆ·æ•°æ®ï¼Œæ— æ³•ä¿å­˜');
                return;
            }

            const updatedData = JSON.parse(JSON.stringify(fullUserData)); // æ·±æ‹·è´
            updatedData.hero = cleanHeroes;
            const jsonStr = JSON.stringify(updatedData, null, 2);

            // Step 1: è®¡ç®—æ–‡ä»¶å“ˆå¸Œï¼ˆä»…å–å‰16å­—èŠ‚ï¼‰
            const hashBuffer = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(jsonStr));
            const fullHashArray = new Uint8Array(hashBuffer);
            const halfHashArray = fullHashArray.slice(0, 16); // åªå–å‰16å­—èŠ‚ï¼ˆ128ä½ï¼‰
            const fileHash = Array.from(halfHashArray).map(b => b.toString(16).padStart(2, '0')).join('');

            console.log('File SHA-256:', fileHash);

            // Step 2: ä¸Šä¼  JSON
            try {
                await fetch(`https://talon-public-1258609989.cos.ap-chongqing.myqcloud.com/${encodedTag}/${encodedTag}.json`, {
                    method: 'PUT',
                    body: jsonStr,
                    headers: { 'Content-Type': 'application/json' }
                });
            } catch (err) {
                alert('âŒ ä¿å­˜å¤±è´¥ï¼šJSON ä¸Šä¼ å‡ºé”™');
                console.error(err);
                return;
            }

            // Step 3: ä» cookie ä¸­æå– passwordHash
            const auth = getCookie('auth');
            if (!auth || !auth.passwordHash) {
                alert('âŒ Cookie ä¸­ç¼ºå°‘ passwordHash å­—æ®µ');
                return;
            }
            const passwordHash = auth.passwordHash.toLowerCase();

            // Step 4: æ„é€ ç­¾å payloadï¼ˆå­—æ®µåå·²ç²¾ç®€ï¼‰
            const timestamp = Date.now();
            const signaturePayload = JSON.stringify({
                ID: battletag,
                F: fileHash,
                T: timestamp,
                P: passwordHash
            });

            const encoder = new TextEncoder();
            const payloadBytes = encoder.encode(signaturePayload);

            // Step 5: æ£€æŸ¥é•¿åº¦ï¼ˆOAEP æœ€å¤§çº¦ 190 å­—èŠ‚ï¼‰
            if (payloadBytes.length > 190) {
                alert(`âŒ ç­¾åæ•°æ®è¿‡é•¿ï¼ˆ${payloadBytes.length} å­—èŠ‚ï¼‰ï¼Œæœ€å¤§å…è®¸ 190 å­—èŠ‚`);
                console.error('Payload too long:', signaturePayload);
                return;
            }

            // Step 6: RSA å…¬é’¥
            const publicKeyPem = `-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsoywmxv9e4Td4yp9g4bl
KpfQvjBXc+Hp7/I+el7aSzozm1awUXssKoAzXvvI9O2SpZ/1I6qH8lm3+cRmuKfl
nKbwdIWC0njlhJLVuNWWhGFZE3H+sD1Ntmv4F1LARFVe17LcO6GzfmFLFnBYeGnl
wsheIlz6tSqq5pfExMCwkWR5vcltfYi1s1mF+i+69M3YzNOEpzkkXsvWrXSmpncA
eeQ4cVYAxpWQMLbG4ozwxWSo6xLsM9a5TNKAYKVOuJVbBBfNvmbd/7wGbIkV4yPK
Rslt7C0rskkC4qjr+AwYoo+DryivVhnMLnehGiUjcFn7FX4EvZmZb8OCLId8510g
mQIDAQAB
-----END PUBLIC KEY-----`;

            // Step 7: PEM â†’ DER
            let binaryDer;
            try {
                const pemHeader = "-----BEGIN PUBLIC KEY-----";
                const pemFooter = "-----END PUBLIC KEY-----";
                const pemContents = publicKeyPem
                    .replace(pemHeader, '')
                    .replace(pemFooter, '')
                    .replace(/\s/g, '');
                const binaryDerString = atob(pemContents);
                binaryDer = new Uint8Array(binaryDerString.length);
                for (let i = 0; i < binaryDerString.length; i++) {
                    binaryDer[i] = binaryDerString.charCodeAt(i);
                }
            } catch (e) {
                alert('âŒ å…¬é’¥è§£æå¤±è´¥');
                console.error(e);
                return;
            }

            // Step 8: å¯¼å…¥å…¬é’¥
            let publicKey;
            try {
                publicKey = await crypto.subtle.importKey(
                    "spki",
                    binaryDer.buffer,
                    { name: "RSA-OAEP", hash: "SHA-256" },
                    true,
                    ["encrypt"]
                );
            } catch (e) {
                alert('âŒ RSA å…¬é’¥å¯¼å…¥å¤±è´¥ï¼š' + e.message);
                console.error(e);
                return;
            }

            // Step 9: åŠ å¯†
            let encrypted;
            try {
                encrypted = await crypto.subtle.encrypt(
                    { name: "RSA-OAEP", hash: "SHA-256" },
                    publicKey,
                    payloadBytes
                );
            } catch (e) {
                alert('âŒ ç­¾ååŠ å¯†å¤±è´¥ï¼š' + e.message);
                console.error(e);
                return;
            }

            // Step 10: è½¬ Base64 å¹¶ä¸Šä¼ ç­¾å
            const encryptedArray = new Uint8Array(encrypted);
            let binary = '';
            for (let i = 0; i < encryptedArray.length; i++) {
                binary += String.fromCharCode(encryptedArray[i]);
            }
            const signatureBase64 = btoa(binary);

            try {
                await fetch(`https://talon-public-1258609989.cos.ap-chongqing.myqcloud.com/${encodedTag}/push.signature`, {
                    method: 'PUT',
                    body: signatureBase64,
                    headers: { 'Content-Type': 'text/plain;charset=UTF-8' }
                });
            } catch (err) {
                alert('âŒ ç­¾åä¸Šä¼ å¤±è´¥');
                console.error(err);
                return;
            }

            alert('âœ… ä¿å­˜æˆåŠŸï¼');
            originalHeroList = [...currentHeroList];
            exitEditMode();
        }

        function exitEditMode() {
            isEditing = false;
            document.querySelectorAll('.remove-hero').forEach(btn => btn.style.display = 'none');
            document.getElementById('editActions').style.display = 'none';
            document.getElementById('editBtn').style.display = 'block';
        }

        function showHeroPickerByIndex(index) {
            const usedHeroes = new Set(currentHeroList.filter(h => h));
            const availableHeroes = heroesData.filter(h => !usedHeroes.has(h.en));

            const tankHeroes = availableHeroes.filter(h => h.role === 'tank');
            const damageHeroes = availableHeroes.filter(h => h.role === 'damage');
            const supportHeroes = availableHeroes.filter(h => h.role === 'support');

            const picker = document.createElement('div');
            picker.className = 'hero-picker';
            picker.dataset.index = index;
            picker.innerHTML = '<div class="picker-title">é€‰æ‹©è‹±é›„</div>';

            const groupsContainer = document.createElement('div');
            groupsContainer.className = 'hero-groups';

            if (tankHeroes.length > 0) groupsContainer.appendChild(renderHeroGroup('é‡è£…', tankHeroes));
            if (damageHeroes.length > 0) groupsContainer.appendChild(renderHeroGroup('è¾“å‡º', damageHeroes));
            if (supportHeroes.length > 0) groupsContainer.appendChild(renderHeroGroup('æ”¯æ´', supportHeroes));

            picker.appendChild(groupsContainer);

            const closeBtn = document.createElement('button');
            closeBtn.className = 'picker-close';
            closeBtn.textContent = 'Ã—';
            closeBtn.onclick = () => document.body.removeChild(picker);
            picker.appendChild(closeBtn);

            document.body.appendChild(picker);
        }

        function renderHeroGroup(title, heroes) {
            const group = document.createElement('div');
            group.className = 'hero-group';
            const titleEl = document.createElement('div');
            titleEl.className = 'group-title';
            titleEl.textContent = title;
            group.appendChild(titleEl);
            const grid = document.createElement('div');
            grid.className = 'hero-grid';
            heroes.forEach(h => {
                const item = document.createElement('div');
                item.className = 'hero-picker-item';
                item.innerHTML = `
            <img src="https://ow.mapleqaq.top/hero/${encodeURIComponent(h.en)}.png" alt="${h.zh}" />
            <span class="hero-name">${h.zh}</span>
        `;
                item.onclick = (e) => {
                    const picker = e.target.closest('.hero-picker');
                    const targetIndex = parseInt(picker.dataset.index);
                    currentHeroList[targetIndex] = h.en;
                    renderHeroesUI();
                    document.body.removeChild(picker);
                };
                grid.appendChild(item);
            });
            group.appendChild(grid);
            return group;
        }

        function initThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            const html = document.documentElement;
            function updateIcon() {
                const isDark = html.getAttribute('data-theme') === 'dark';
                themeToggle.textContent = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
            }
            themeToggle.addEventListener('click', () => {
                const current = html.getAttribute('data-theme');
                const newTheme = current === 'dark' ? 'light' : 'dark';
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateIcon();
            });
            const saved = localStorage.getItem('theme') || 'dark';
            html.setAttribute('data-theme', saved);
            updateIcon();
        }

        document.addEventListener('DOMContentLoaded', async () => {
            initThemeToggle();
            const tag = await verifyAuth();
            if (tag) {
                renderProfile(tag);
            }
        });


        // é€€å‡ºç™»å½•åŠŸèƒ½
        document.getElementById('logoutBtn')?.addEventListener('click', () => {
            // æ¸…é™¤æ‰€æœ‰ç›¸å…³ cookieï¼ˆè¿™é‡Œæ¸…é™¤ 'auth' å³å¯ï¼Œå› ä¸ºåªæœ‰å®ƒç”¨äºè®¤è¯ï¼‰
            deleteCookie('auth');

            // å¯é€‰ï¼šæ¸…é™¤å…¶ä»–å¯èƒ½çš„ cookieï¼ˆå¦‚ theme ç­‰ï¼Œä½†é€šå¸¸ä¸éœ€è¦ï¼‰
            // ä¾‹å¦‚ï¼šdeleteCookie('theme');

            // è·³è½¬åˆ°ç½‘ç«™æ ¹ç›®å½•
            window.location.href = './';
        });
    </script>
</body>

</html>